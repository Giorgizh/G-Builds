{% extends "base.html" %}
{% block head %}
<title>AI</title>
<style>
  .ai-wrap { width: min(900px, 92%); margin: 40px auto; }
  .ai-box { display: flex; gap: 10px; }
  #msg { flex: 1; padding: 12px 14px; border: 1px solid #ccc; border-radius: 8px; }
  #send { padding: 12px 16px; border: 0; border-radius: 8px; background:#ff0000; color:#fff; font-weight:700; cursor:pointer; }
  #out { margin-top: 16px; padding: 14px; background:#f6f7fb; border:1px solid #e6e6ef; border-radius: 10px; white-space: pre-wrap; }
</style>
<link rel="stylesheet" href="../static/css/reset.css">
{% endblock %}

{% block body %}
<div class="ai-wrap">
  <h1>AI Assistant</h1>

  <div class="ai-box">
    <input id="msg" placeholder="Ask AI..." />
    <button id="send">Send</button>
  </div>

  <pre id="out">Reply will appear here...</pre>
</div>

<script>
  const msg = document.getElementById("msg");
  const out = document.getElementById("out");
  const send = document.getElementById("send");

  async function sendMsg() {
    const message = msg.value.trim();
    if (!message) return;

    send.disabled = true;
    out.textContent = "Thinking...";

    try {
      const r = await fetch("/ai/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message }),
      });

      const data = await r.json();
      out.textContent = data.reply || "No reply";
    } catch (e) {
      out.textContent = "Request failed: " + e;
    } finally {
      send.disabled = false;
    }
  }

  send.addEventListener("click", sendMsg);
  msg.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMsg();
  });
</script>
{% endblock %}
